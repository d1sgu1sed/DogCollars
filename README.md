# DogCollars
DogCollars — проект, созданный для отслеживания бездомных собак и оказания помощи им. DogCollars был написан с использованием языка программирования Python и фреймворка FastAPI.

## Как это работает?
Создаются запросы на фреймворке FastAPI, представляющие из себя обработку данных (геолокации, текст заданий, ID'шники и т.д.). К приложению подключена база данных на PostgreSQL, геолокация ошейников отслеживается с помощью базовой станции LoRa.

## Сценарии использования:
  - Регистрация/вход пользователя;
  - Создание профилей для собак + регистрация ошейника (ID'шника ошейника, отображение клички, пола и является ли собака отслеживаемой);
  - Вывод активных ошейников и их геолокации с обновлением в каждую минуту;
  - Пост задачи для одной собаки только для зарегистрированного пользователя;
  - Вывод задач для выбранной собаки;
  - Отметить задачу как выполненную (доступно, если геолокация пользователя находится в определённом радиусе от геолокации ошейника);
    
## FastAPI
  - Запрос на регистрацию пользователя. Параметры: имя, фамилия, адрес почты, пароль;
  - Запрос на вход. Параметры: адрес почты, пароль;
  - Запрос на создание профиля собаки. Параметры: кличка, пол, токен сессии (передается автоматически);
  - Запрос на вывод активных ошейников. Параметры: токен сессии (передается автоматически);
  - Запрос на вывод определенной собаки: Параметры: кличка или ID ошейника, токен сессии (передается автоматически);
  - Запрос на пост задачи. Параметры: токен сессии (передается автоматически), ID-ошейника, описание задачи;
  - Запрос на вывод задач для определенной собаки. Параметры: ID собаки, токен сессии (передается автоматически);
  - Запрос на вывод всех выполненных задач. Параметры: токен сессии (передается автоматически);
  - Запрос на отметку выполнения задачи. Параметры: токен сессии (передается автоматически), геолокация пользователя, геолокация выбранной собаки
  - Запрос на вывод местоположения собаки

## Для поднятия сервисов баз для локальной разработки нужно запустить команду:
```
make up
```
## Для накатывания миграций, если файла alembic.ini ещё нет, нужно запустить в терминале команду:
```
alembic init migrations
```
После этого будет создана папка с миграциями и конфигурационный файл для алембика.

В alembic.ini нужно задать адрес базы данных, в которую будем катать миграции.

Дальше идём в папку с миграциями и открываем env.py, там вносим изменения в блок, где написано:
```
from myapp import mymodel
```
Дальше вводим: ``` alembic revision --autogenerate -m "comment" - делается при любых изменениях моделей ```
Будет создана миграция
Дальше вводим: ``` alembic upgrade heads ```
Для того, чтобы во время тестов нормально генерировались миграции нужно:

сначала попробовать запустить тесты обычным образом. с первого раза все должно упасть
если после падения в папке tests создались алембиковские файлы, то нужно прописать туда данные по миграхам
если они не создались, то зайти из консоли в папку test и вызвать вручную команды на миграции, чтобы файлы появились
